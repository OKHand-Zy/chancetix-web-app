generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model User {
  id                    String                 @id @default(cuid())
  name                  String?
  email                 String?                @unique
  emailVerified         DateTime?
  image                 String?
  password              String?
  role                  UserRole               @default(USER)
  cellphone             String?
  identity              String?
  isTwoFactorEnabled    Boolean                @default(false)
  accounts              Account[]
  Event                 Event[]
  PendingTicket         PendingTicket[]
  tickets               Ticket[]
  twoFactorConfirmation TwoFactorConfirmation?
}

model VerificationToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model PasswordResetToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model TwoFactorToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model TwoFactorConfirmation {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Event {
  id            String          @id @default(cuid())
  name          String
  date          DateTime
  location      String
  capacity      Int
  image         String          @default("/images/activity_img/Null.png")
  hostId        String
  host          User            @relation(fields: [hostId], references: [id], onDelete: Cascade)
  PendingTicket PendingTicket[]
  tickets       Ticket[]
  TicketType    TicketTypes[]
}

model TicketTypes {
  id          String         @id @default(cuid())
  eventId     String
  typeName    String         @default("normal")
  TicketGroup TicketGroups[]
  event       Event          @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([id, eventId])
}

model TicketGroups {
  id            String      @id @default(cuid())
  ticketTypeId  String
  eventId       String
  groupName     String?     @default("standard")
  groupCapacity Int?
  price         Int?
  TicketType    TicketTypes @relation(fields: [ticketTypeId, eventId], references: [id, eventId], onDelete: Cascade)
}

model PendingTicket {
  id           String   @id @default(cuid())
  userId       String?
  eventId      String?
  serialNumber String?  @unique
  ticketType   String?  @default("normal")
  ticketGroup  String?  @default("standard")
  position     String?  @default("free")
  customerName String?  @default("unknown")
  price        Int?
  expires      DateTime
  Event        Event?   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user         User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Ticket {
  id           String       @id @default(cuid())
  serialNumber String?      @unique
  ticketType   String?      @default("normal")
  ticketGroup  String?      @default("standard")
  position     String?      @default("free")
  price        Int?
  customerName String?
  userId       String
  eventId      String
  status       TicketStatus @default(PURCHASED)
  event        Event        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LTicket {
  id           Int           @id @default(autoincrement())
  activityName String?
  actype       String
  acSerNumber  String?       @unique
  volunteerF   String?
  vFCounts     Int?
  volunteerS   String?
  vSCounts     Int?
  users        LTicketUser[]
}

model LTicketUser {
  id                Int     @id @default(autoincrement())
  tickeSerNumber    String
  volunteerType     String?
  customerName      String?
  customerCellphone String?
  customerIdentity  String?
  lticket           LTicket @relation(fields: [tickeSerNumber], references: [acSerNumber], onDelete: Cascade)

  @@unique([customerCellphone, customerIdentity])
}

model SubscribeTicket {
  id          String  @id @default(cuid())
  userId      String?
  eventId     String?
  tickettype  String?
  ticketGroup String
  ticketCount Int?
}

model PaymentOrder {
  id      String  @id @default(cuid())
  userId  String?
  eventId String?
}

model SwitchTicket {
  id           Int     @id @default(autoincrement())
  eventName    String?
  serialNumber String? @unique
  ticketType   String?
  ticketGroup  String?
  position     String?
  price        Int?
}

model Tasks {
  id       String           @id
  title    String
  status   TasksStatus
  label    labelsStatus
  priority PrioritiesStatus
}

enum UserRole {
  ADMIN
  USER
}

enum TicketStatus {
  PURCHASED
  USED
  EXPIRED
}

enum TasksStatus {
  backlog
  todo
  in_progress
  done
  canceled
}

enum labelsStatus {
  bug
  feature
  documentation
}

enum PrioritiesStatus {
  low
  medium
  high
}
